<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,           <!-- Type de modèle -->
          <div class="control-section">
            <h3>👤 Type d'avatar</h3>
            <div class="face-type-selector">
              <button class="face-btn active" data-face="male">
                <div class="face-icon">👨</div>
                <span>Homme</span>
              </button>
              <button class="face-btn" data-face="female">
                <div class="face-icon">👩</div>
                <span>Femme</span>
              </button>
              <button class="face-btn" data-face="robot">
                <div class="face-icon">🤖</div>
                <span>Robot</span>
              </button>
              <button class="face-btn" data-face="humanoid">
                <div class="face-icon">👽</div>
                <span>Humanoïde</span>
              </button>
            </div>
          </div>1.0" />
    <title>Avatar 3D - Du Chevreuil</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="avatar-3d-container">
      <div class="back-button-contai          <!-- Tenues et vêtements -->
          <div class="control-section">
            <h3>👕 Tenues</h3>
            <div class="outfit-selector">
              <label>Style de tenue :</label>
              <select class="outfit-select">
                <option value="casual">Décontracté</option>
                <option value="formal">Formel</option>
                <option value="sporty">Sportif</option>
                <option value="fantasy">Fantasy</option>
              </select>
            </div>
            
            <div class="clothing-colors">
              <div class="color-input-group">
                <label>Haut :</label>
                <input type="color" id="top-color" value="#4A90E2">
              </div>
              <div class="color-input-group">
                <label>Bas :</label>
                <input type="color" id="bottom-color" value="#2C3E50">
              </div>
              <div class="color-input-group">
                <label>Chaussures :</label>
                <input type="color" id="shoes-color" value="#8B4513">
              </div>
            </div>
          </div>

          <!-- Accessoires -->
          <div class="control-section">
            <h3>🎩 Accessoires</h3>
            <div class="accessories-section">
              <div class="accessory-group">
                <label>Chapeau :</label>
                <select class="accessory-select" data-accessory="hat">
                  <option value="none">Aucun</option>
                  <option value="cap">Casquette</option>
                  <option value="beanie">Bonnet</option>
                  <option value="fedora">Fedora</option>
                  <option value="crown">Couronne</option>
                </select>
              </div>
              
              <div class="accessory-group">
                <label>Lunettes :</label>
                <select class="accessory-select" data-accessory="glasses">
                  <option value="none">Aucunes</option>
                  <option value="regular">Normales</option>
                  <option value="sunglasses">Solaires</option>
                  <option value="fantasy">Fantasy</option>
                </select>
              </div>
              
              <div class="accessory-group">
                <label>Bijoux :</label>
                <select class="accessory-select" data-accessory="jewelry">
                  <option value="none">Aucuns</option>
                  <option value="necklace">Collier</option>
                  <option value="earrings">Boucles d'oreilles</option>
                  <option value="both">Les deux</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Poses et allure -->
          <div class="control-section">
            <h3>🕺 Pose et allure</h3>
            <div class="pose-selector">
              <div class="pose-grid">
                <button class="pose-btn active" data-pose="idle">
                  🧍 Debout
                </button>
                <button class="pose-btn" data-pose="confident">
                  💪 Confiant
                </button>
                <button class="pose-btn" data-pose="casual">
                  😎 Décontracté
                </button>
                <button class="pose-btn" data-pose="greeting">
                  👋 Salutation
                </button>
                <button class="pose-btn" data-pose="thinking">
                  🤔 Réflexion
                </button>
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <button class="save-avatar-btn" onclick="saveAvatar3D()">
              <img src="icons/save.svg" alt="Sauvegarder" />
              Sauvegarder
            </button>
            <button class="reset-btn" onclick="resetAvatar3D()">
              <img src="icons/arrow-counterclockwise.svg" alt="Reset" />
              Reset
            </button>
            <button class="randomize-btn" onclick="randomizeAvatar()">
              <img src="icons/shuffle.svg" alt="Aléatoire" />
              Aléatoire
            </button>
          </div> <button class="back-btn" onclick="goHome()">
          <img src="icons/arrow-left.svg" alt="Retour" />
        </button>
      </div>

      <div class="avatar-editor">
        <div class="avatar-viewport">
          <canvas id="avatar3d-canvas"></canvas>
          <div class="loading-overlay" id="loading-overlay">
            <div class="loading-spinner"></div>
            <p>Chargement de l'avatar 3D...</p>
          </div>
        </div>

        <div class="avatar-controls">
          <h2>Créateur de Visage 3D</h2>

          <!-- Type de visage de base -->
          <div class="control-section">
            <h3>Type de visage</h3>
            <div class="face-type-selector">
              <button class="face-btn active" data-face="male">
                <span class="face-icon">👨</span>
                <span>Masculin</span>
              </button>
              <button class="face-btn" data-face="female">
                <span class="face-icon">👩</span>
                <span>Féminin</span>
              </button>
            </div>
          </div>

          <!-- Couleur de peau -->
          <div class="control-section">
            <h3>Couleur de peau</h3>
            <div class="skin-color-palette">
              <div
                class="color-option active"
                data-skin="skin3"
                style="background-color: #d08b5b"
              ></div>
              <div
                class="color-option"
                data-skin="skin1"
                style="background-color: #fdbcb4"
              ></div>
              <div
                class="color-option"
                data-skin="skin2"
                style="background-color: #edb98a"
              ></div>
              <div
                class="color-option"
                data-skin="skin4"
                style="background-color: #ae5d29"
              ></div>
              <div
                class="color-option"
                data-skin="skin5"
                style="background-color: #8d5524"
              ></div>
              <div
                class="color-option"
                data-skin="skin6"
                style="background-color: #614335"
              ></div>
              <div
                class="color-option"
                data-skin="skin7"
                style="background-color: #3c2415"
              ></div>
              <div
                class="color-option fantasy"
                data-skin="fantasy1"
                style="background-color: #4a90e2"
              ></div>
              <div
                class="color-option fantasy"
                data-skin="fantasy2"
                style="background-color: #7ed321"
              ></div>
              <div
                class="color-option fantasy"
                data-skin="fantasy3"
                style="background-color: #9013fe"
              ></div>
            </div>
          </div>

          <!-- Coiffure -->
          <div class="control-section">
            <h3>Coiffure</h3>
            <div class="hair-style-list">
              <select class="hair-select" data-hair>
                <option value="short">✂️ Cheveux courts</option>
                <option value="medium">💇 Cheveux mi-longs</option>
                <option value="long">👱 Cheveux longs</option>
                <option value="curly">🌀 Cheveux bouclés</option>
                <option value="spiky">⚡ Cheveux hérissés</option>
                <option value="wavy">� Cheveux ondulés</option>
                <option value="straight">📏 Cheveux raides</option>
                <option value="buzz">🪒 Coupe militaire</option>
                <option value="mohawk">🗯️ Crête iroquoise</option>
                <option value="bald">👴 Chauve</option>
              </select>
            </div>

            <div class="hair-color-section">
              <label>Couleur des cheveux:</label>
              <div class="hair-color-palette">
                <div
                  class="color-option active"
                  data-hair-color="brown"
                  style="background-color: #8b4513"
                ></div>
                <div
                  class="color-option"
                  data-hair-color="blonde"
                  style="background-color: #faf0be"
                ></div>
                <div
                  class="color-option"
                  data-hair-color="black"
                  style="background-color: #2c1810"
                ></div>
                <div
                  class="color-option"
                  data-hair-color="red"
                  style="background-color: #cc6600"
                ></div>
                <div
                  class="color-option"
                  data-hair-color="white"
                  style="background-color: #f5f5f5"
                ></div>
                <div
                  class="color-option fantasy"
                  data-hair-color="blue"
                  style="background-color: #0066cc"
                ></div>
                <div
                  class="color-option fantasy"
                  data-hair-color="pink"
                  style="background-color: #ff69b4"
                ></div>
                <div
                  class="color-option fantasy"
                  data-hair-color="green"
                  style="background-color: #00cc66"
                ></div>
              </div>
            </div>
          </div>

          <!-- Yeux -->
          <div class="control-section">
            <h3>Yeux</h3>
            <div class="eye-controls">
              <div class="eye-color-section">
                <label>Couleur des yeux:</label>
                <div class="eye-color-palette">
                  <div
                    class="color-option active"
                    data-eye-color="brown"
                    style="background-color: #8b4513"
                  ></div>
                  <div
                    class="color-option"
                    data-eye-color="blue"
                    style="background-color: #4169e1"
                  ></div>
                  <div
                    class="color-option"
                    data-eye-color="green"
                    style="background-color: #228b22"
                  ></div>
                  <div
                    class="color-option"
                    data-eye-color="hazel"
                    style="background-color: #cd853f"
                  ></div>
                  <div
                    class="color-option"
                    data-eye-color="gray"
                    style="background-color: #708090"
                  ></div>
                  <div
                    class="color-option fantasy"
                    data-eye-color="violet"
                    style="background-color: #8a2be2"
                  ></div>
                  <div
                    class="color-option fantasy"
                    data-eye-color="red"
                    style="background-color: #dc143c"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Expression faciale -->
          <div class="control-section">
            <h3>Expression</h3>
            <div class="expression-grid">
              <button class="expr-btn active" data-expression="neutral">😐 Neutre</button>
              <button class="expr-btn" data-expression="happy">😊 Heureux</button>
              <button class="expr-btn" data-expression="sad">😢 Triste</button>
              <button class="expr-btn" data-expression="angry">😠 En colère</button>
              <button class="expr-btn" data-expression="surprised">😮 Surpris</button>
              <button class="expr-btn" data-expression="wink">😉 Clin d'œil</button>
            </div>
          </div>

          <!-- Morphologie faciale -->
          <div class="control-section">
            <h3>Morphologie du visage</h3>
            <div class="morphology-controls">
              <div class="morph-slider-group">
                <label for="nose-size">� Taille du nez:</label>
                <input
                  type="range"
                  id="nose-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="noseSize"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="eye-size">👁️ Taille des yeux:</label>
                <input
                  type="range"
                  id="eye-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="eyeSize"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="mouth-size">👄 Taille de la bouche:</label>
                <input
                  type="range"
                  id="mouth-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="mouthSize"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="jaw-width">🦴 Largeur de la mâchoire:</label>
                <input
                  type="range"
                  id="jaw-width"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="jawWidth"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="cheek-size">😊 Taille des joues:</label>
                <input
                  type="range"
                  id="cheek-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="cheekSize"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="forehead-height">🧠 Hauteur du front:</label>
                <input
                  type="range"
                  id="forehead-height"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="foreheadHeight"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="ear-size">👂 Taille des oreilles:</label>
                <input
                  type="range"
                  id="ear-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="earSize"
                />
                <span class="slider-value">50%</span>
              </div>

              <div class="morph-slider-group">
                <label for="chin-size">🎭 Taille du menton:</label>
                <input
                  type="range"
                  id="chin-size"
                  class="morph-slider"
                  min="0"
                  max="100"
                  value="50"
                  data-morph="chinSize"
                />
                <span class="slider-value">50%</span>
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <button class="save-avatar-btn" onclick="saveAvatar3D()">
              <img src="icons/check-circle-fill.svg" alt="Sauvegarder" />
              Sauvegarder
            </button>
            <button class="reset-btn" onclick="resetAvatar3D()">
              <img src="icons/arrow-counterclockwise.svg" alt="Reset" />
              Reset
            </button>
            <button class="randomize-btn" onclick="randomizeAvatar()">
              <img src="icons/shuffle.svg" alt="Aléatoire" />
              Aléatoire
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="https://threejs.org/examples/js/loaders/GLTFLoader.js"></script>

    <script src="pageTransitions.js"></script>
    <script src="avatar3d.js"></script>
    <script>
      function goHome() {
        PageTransitions.goToPage("index.html");
      }

      function saveAvatar3D() {
        if (window.avatarEditor) {
          // TODO: Implémenter la sauvegarde
          console.log("Configuration actuelle:", window.avatarEditor.config);
          alert("Avatar 3D sauvegardé !");
        }
      }

      function resetAvatar3D() {
        if (window.avatarEditor) {
          window.avatarEditor.createDefaultModel();
        }
      }

      function randomizeAvatar() {
        if (window.avatarEditor) {
          window.avatarEditor.randomizeConfiguration();
        }
      }

      // Initialisation de l'éditeur d'avatar 3D avec gestion d'erreurs
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM chargé, initialisation de l'éditeur d'avatar...");

        // Attendre un peu que tous les scripts soient chargés
        setTimeout(() => {
          // Vérifier que Three.js est chargé
          if (typeof THREE === "undefined") {
            console.error("Three.js n'est pas chargé");
            document.getElementById("loading-overlay").innerHTML =
              '<div class="loading-spinner"></div><p>Erreur: Three.js non disponible</p>';
            return;
          }

          console.log("Three.js version:", THREE.REVISION);

          try {
            window.avatarEditor = new Avatar3DManager("avatar3d-canvas");
            console.log("Éditeur d'avatar initialisé");
          } catch (error) {
            console.error("Erreur lors de l'initialisation:", error);
            document.getElementById("loading-overlay").innerHTML =
              '<div class="loading-spinner"></div><p>Erreur d\'initialisation: ' +
              error.message +
              "</p>";
          }
        }, 500);
      });
    </script>
  </body>
</html>
