<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Avatar 3D</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      .test-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
        max-width: 800px;
        width: 90%;
      }

      .avatar-preview {
        width: 100%;
        height: 400px;
        border-radius: 15px;
        background: rgba(0, 0, 0, 0.3);
        margin-bottom: 20px;
        position: relative;
        overflow: hidden;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .control-group {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 10px;
      }

      .control-group h3 {
        color: white;
        margin: 0 0 10px 0;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      button {
        background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        border: none;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        margin: 5px;
        transition: all 0.3s ease;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      button.active {
        background: linear-gradient(45deg, #00d2d3, #54a0ff);
      }

      select {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        width: 100%;
      }

      select option {
        background: #333;
        color: white;
      }

      .status {
        background: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 12px;
      }

      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 18px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1 style="color: white; text-align: center; margin-bottom: 20px">Test Avatar 3D</h1>

      <div class="avatar-preview" id="avatar-container">
        <div class="loading" id="loading">Chargement du mod√®le 3D...</div>
      </div>

      <div class="controls">
        <div class="control-group">
          <h3>Type de visage</h3>
          <button id="face-male" onclick="changeFaceType('male')">üë® Masculin</button>
          <button id="face-female" onclick="changeFaceType('female')">üë© F√©minin</button>
        </div>

        <div class="control-group">
          <h3>Couleur de peau</h3>
          <button
            onclick="changeSkinColor('#FFDBAC')"
            style="background: #ffdbac; color: #333"
          >
            Claire
          </button>
          <button
            onclick="changeSkinColor('#DEB887')"
            style="background: #deb887; color: #333"
          >
            Moyenne
          </button>
          <button onclick="changeSkinColor('#8B4513')" style="background: #8b4513">
            Fonc√©e
          </button>
        </div>

        <div class="control-group">
          <h3>Coiffure</h3>
          <select id="hair-select" onchange="changeHair(this.value)">
            <option value="brown">Brun</option>
            <option value="black">Noir</option>
            <option value="blonde">Blond</option>
            <option value="red">Roux</option>
            <option value="gray">Gris</option>
            <option value="bald">Chauve</option>
          </select>
        </div>

        <div class="control-group">
          <h3>Actions</h3>
          <button onclick="testFallback()">Tester mod√®le par d√©faut</button>
          <button onclick="reloadModel()">Recharger mod√®le</button>
          <button onclick="downloadModel()">T√©l√©charger avatar</button>
        </div>
      </div>

      <div class="status" id="status">Initialisation...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="avatar3d.js"></script>

    <script>
      let avatarEditor;
      const statusDiv = document.getElementById("status");

      function updateStatus(message) {
        statusDiv.innerHTML += "<br>" + new Date().toLocaleTimeString() + ": " + message;
        statusDiv.scrollTop = statusDiv.scrollHeight;
        console.log("Avatar Test:", message);
      }

      function changeFaceType(type) {
        document
          .querySelectorAll('[id^="face-"]')
          .forEach((btn) => btn.classList.remove("active"));
        document.getElementById("face-" + type).classList.add("active");

        if (avatarEditor) {
          avatarEditor.changeFaceType(type);
          updateStatus(`Type de visage chang√©: ${type}`);
        }
      }

      function changeSkinColor(color) {
        if (avatarEditor) {
          avatarEditor.config.skinColor = color;
          avatarEditor.updateSkinColor();
          updateStatus(`Couleur de peau chang√©e: ${color}`);
        }
      }

      function changeHair(style) {
        if (avatarEditor) {
          avatarEditor.config.hairStyle = style;
          avatarEditor.updateFaceModel();
          updateStatus(`Coiffure chang√©e: ${style}`);
        }
      }

      function testFallback() {
        if (avatarEditor) {
          avatarEditor.createDefaultModel();
          updateStatus("Mod√®le par d√©faut cr√©√©");
        }
      }

      function reloadModel() {
        if (avatarEditor) {
          avatarEditor.loadFaceModel();
          updateStatus("Rechargement du mod√®le...");
        }
      }

      function downloadModel() {
        updateStatus("Fonction de t√©l√©chargement √† impl√©menter");
      }

      // Initialisation
      document.addEventListener("DOMContentLoaded", function () {
        updateStatus("Initialisation de l'√©diteur d'avatar...");

        try {
          avatarEditor = new AvatarEditor("avatar-container");
          updateStatus("√âditeur d'avatar initialis√© avec succ√®s");

          // Test initial avec le type masculin
          setTimeout(() => {
            changeFaceType("male");
          }, 1000);
        } catch (error) {
          updateStatus("Erreur lors de l'initialisation: " + error.message);
          console.error("Erreur Avatar:", error);
        }
      });

      // Gestion des erreurs globales
      window.addEventListener("error", function (e) {
        updateStatus("Erreur JS: " + e.message);
      });

      // Monitoring des requ√™tes r√©seau
      const originalFetch = window.fetch;
      window.fetch = function (...args) {
        updateStatus("Requ√™te r√©seau: " + args[0]);
        return originalFetch
          .apply(this, args)
          .then((response) => {
            updateStatus("R√©ponse re√ßue: " + response.status + " - " + args[0]);
            return response;
          })
          .catch((error) => {
            updateStatus("Erreur r√©seau: " + error.message + " - " + args[0]);
            throw error;
          });
      };
    </script>
  </body>
</html>
